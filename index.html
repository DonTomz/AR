<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Artwork Viewer</title>
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        .a-canvas {
            width: 100vw !important;
            height: 100vh !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            z-index: 1;
        }

        .ar-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 8px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .ar-button {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .instructions {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 8px;
            z-index: 1000;
            text-align: center;
            font-size: 14px;
            width: 80%;
            max-width: 300px;
        }

        .placement-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 2px solid #4CAF50;
            border-radius: 50%;
            z-index: 1000;
            pointer-events: none;
        }

        .placement-indicator::after {
            content: '+';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #4CAF50;
            font-size: 24px;
        }

        .reference-points {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .reference-point {
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(76, 175, 80, 0.6);
            border-radius: 50%;
        }

        .a-enter-vr {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="instructions">Move your device to detect surfaces</div>
    <div class="placement-indicator"></div>
    <div class="reference-points"></div>

    <a-scene
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        renderer="antialias: true; alpha: true"
        vr-mode-ui="enabled: false">

        <a-assets>
            <img id="artwork" crossorigin="anonymous">
        </a-assets>

        <a-entity id="artwork-container"></a-entity>
        <a-entity camera></a-entity>

    </a-scene>

    <div class="ar-controls">
        <button class="ar-button" id="place-btn">Place Artwork</button>
        <button class="ar-button" id="resize-up">Larger</button>
        <button class="ar-button" id="resize-down">Smaller</button>
        <button class="ar-button" id="rotate-btn">Rotate</button>
    </div>

    <script>
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const artworkUrl = decodeURIComponent(urlParams.get('artwork'));
            
            if (!artworkUrl) {
                alert('No artwork URL provided');
                return;
            }

            // Set artwork source
            document.getElementById('artwork').src = artworkUrl;

            let artwork = null;
            let scale = 1;
            let rotation = 0;

            // Create reference points grid
            const referencePointsContainer = document.querySelector('.reference-points');
            const gridSize = 20;
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const point = document.createElement('div');
                    point.className = 'reference-point';
                    point.style.left = `${(i * 100 / (gridSize - 1))}%`;
                    point.style.top = `${(j * 100 / (gridSize - 1))}%`;
                    referencePointsContainer.appendChild(point);
                }
            }

            // Initialize camera with full viewport
            const constraints = {
                video: {
                    facingMode: 'environment',
                    width: { ideal: window.innerWidth },
                    height: { ideal: window.innerHeight }
                }
            };

            navigator.mediaDevices.getUserMedia(constraints)
                .then(stream => {
                    const video = document.querySelector('video');
                    if (video) {
                        video.srcObject = stream;
                        video.style.width = '100vw';
                        video.style.height = '100vh';
                        video.style.objectFit = 'cover';
                    }
                })
                .catch(error => {
                    console.error('Camera error:', error);
                    alert('Please allow camera access to use AR features');
                });

            document.getElementById('place-btn').addEventListener('click', function() {
                const camera = document.querySelector('[camera]');
                const position = camera.getAttribute('position');
                const rotation = camera.getAttribute('rotation');
                
                if (!artwork) {
                    artwork = document.createElement('a-image');
                    artwork.setAttribute('src', '#artwork');
                    artwork.setAttribute('position', `0 0 -3`);
                    artwork.setAttribute('scale', `${scale} ${scale} ${scale}`);
                    artwork.setAttribute('look-at', '[camera]');
                    
                    document.getElementById('artwork-container').appendChild(artwork);
                    this.textContent = 'Reposition';
                    document.querySelector('.instructions').textContent = 'Use controls to adjust artwork';
                } else {
                    // Calculate position in front of camera
                    const distance = -3;
                    const radians = rotation.y * (Math.PI / 180);
                    const x = position.x + (distance * Math.sin(radians));
                    const z = position.z - (distance * Math.cos(radians));
                    
                    artwork.setAttribute('position', `${x} ${position.y} ${z}`);
                }
            });

            document.getElementById('resize-up').addEventListener('click', function() {
                if (artwork) {
                    scale *= 1.2;
                    artwork.setAttribute('scale', `${scale} ${scale} ${scale}`);
                }
            });

            document.getElementById('resize-down').addEventListener('click', function() {
                if (artwork) {
                    scale *= 0.8;
                    artwork.setAttribute('scale', `${scale} ${scale} ${scale}`);
                }
            });

            document.getElementById('rotate-btn').addEventListener('click', function() {
                if (artwork) {
                    rotation += 45;
                    artwork.setAttribute('rotation', `0 ${rotation} 0`);
                }
            });

            // Handle device orientation changes
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    const scene = document.querySelector('a-scene');
                    if (scene) {
                        scene.resize();
                    }
                }, 200);
            });

            // Prevent zoom
            document.addEventListener('touchmove', function(e) {
                if (e.scale !== 1) {
                    e.preventDefault();
                }
            }, { passive: false });
        };
    </script>
</body>
</html> 